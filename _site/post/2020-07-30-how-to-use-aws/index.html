<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2020-07-30">

<title>HakyImLab Notes - How to Use AWS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": true,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">HakyImLab Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Miscel</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/hakyimlab/web-lab-notes-quarto" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#im-labs-aws-best-practices" id="toc-im-labs-aws-best-practices" class="nav-link active" data-scroll-target="#im-labs-aws-best-practices">Im lab’s AWS Best Practices</a></li>
  <li><a href="#how-to-login-to-your-aws-account" id="toc-how-to-login-to-your-aws-account" class="nav-link" data-scroll-target="#how-to-login-to-your-aws-account">How to login to your AWS account?</a></li>
  <li><a href="#how-to-manage-aws-access-and-secret-keys" id="toc-how-to-manage-aws-access-and-secret-keys" class="nav-link" data-scroll-target="#how-to-manage-aws-access-and-secret-keys">How to manage AWS access and secret keys?</a></li>
  <li><a href="#how-to-install-and-upgrade-the-aws-cli" id="toc-how-to-install-and-upgrade-the-aws-cli" class="nav-link" data-scroll-target="#how-to-install-and-upgrade-the-aws-cli">How to install and upgrade the AWS CLI?</a></li>
  <li><a href="#how-to-configure-the-aws-cli" id="toc-how-to-configure-the-aws-cli" class="nav-link" data-scroll-target="#how-to-configure-the-aws-cli">How to configure the AWS CLI?</a></li>
  <li><a href="#how-to-launch-your-ec2-instances-through-aws-console" id="toc-how-to-launch-your-ec2-instances-through-aws-console" class="nav-link" data-scroll-target="#how-to-launch-your-ec2-instances-through-aws-console">How to launch your EC2 instances through AWS console?</a></li>
  <li><a href="#how-to-launch-your-ec2-instance-using-cloudformation-through-cli" id="toc-how-to-launch-your-ec2-instance-using-cloudformation-through-cli" class="nav-link" data-scroll-target="#how-to-launch-your-ec2-instance-using-cloudformation-through-cli">How to launch your EC2 instance using Cloudformation through CLI?</a></li>
  <li><a href="#how-to-associate-an-elastic-ip-address-to-your-ec2-instance" id="toc-how-to-associate-an-elastic-ip-address-to-your-ec2-instance" class="nav-link" data-scroll-target="#how-to-associate-an-elastic-ip-address-to-your-ec2-instance">How to associate an Elastic IP address to your EC2 instance</a></li>
  <li><a href="#how-to-peer-aws-vpc" id="toc-how-to-peer-aws-vpc" class="nav-link" data-scroll-target="#how-to-peer-aws-vpc">How to peer AWS VPC?</a></li>
  <li><a href="#how-to-get-your-amazon-ec2-instance-id-using-aws-cli" id="toc-how-to-get-your-amazon-ec2-instance-id-using-aws-cli" class="nav-link" data-scroll-target="#how-to-get-your-amazon-ec2-instance-id-using-aws-cli">How to get your Amazon EC2 instance id using AWS CLI?</a></li>
  <li><a href="#how-to-stop-an-ec2-instance-using-aws-cli" id="toc-how-to-stop-an-ec2-instance-using-aws-cli" class="nav-link" data-scroll-target="#how-to-stop-an-ec2-instance-using-aws-cli">How to stop an EC2 instance using AWS CLI?</a></li>
  <li><a href="#how-to-start-an-ec2-instance-using-aws-cli" id="toc-how-to-start-an-ec2-instance-using-aws-cli" class="nav-link" data-scroll-target="#how-to-start-an-ec2-instance-using-aws-cli">How to start an EC2 instance using AWS CLI?</a></li>
  <li><a href="#how-to-get-the-ip-address-of-the-running-instance-using-aws-cli" id="toc-how-to-get-the-ip-address-of-the-running-instance-using-aws-cli" class="nav-link" data-scroll-target="#how-to-get-the-ip-address-of-the-running-instance-using-aws-cli">How to get the IP address of the running instance using AWS CLI?</a></li>
  <li><a href="#how-to-automatically-stop-the-instance" id="toc-how-to-automatically-stop-the-instance" class="nav-link" data-scroll-target="#how-to-automatically-stop-the-instance">How to automatically stop the instance?</a></li>
  <li><a href="#how-to-set-up-amazon-simple-notification-service" id="toc-how-to-set-up-amazon-simple-notification-service" class="nav-link" data-scroll-target="#how-to-set-up-amazon-simple-notification-service">How to set Up Amazon Simple Notification Service?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">How to Use AWS</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
  <div class="quarto-categories">
    <div class="quarto-category">how_to</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 30, 2020</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="im-labs-aws-best-practices" class="level2">
<h2 class="anchored" data-anchor-id="im-labs-aws-best-practices">Im lab’s AWS Best Practices</h2>
<ul>
<li><p>Stop/start your EC2 instances programatically through AWS Command Line Interface (CLI).</p></li>
<li><p>Stop your EC2 instances to avoid incurring charges when not in use.</p></li>
<li><p>Your secret key must be kept very secret. Please store it in a very safe place and don’t include it in your code.</p></li>
</ul>
</section>
<section id="how-to-login-to-your-aws-account" class="level2">
<h2 class="anchored" data-anchor-id="how-to-login-to-your-aws-account">How to login to your AWS account?</h2>
<p>you should have gotten the credentials from the lab’s cloud administrator https://hakyimlab.signin.aws.amazon.com/console</p>
<p>Once you login to your account using temporary password, you can reset your password by the following policy: * Minimum password length (6 to 128). * Require at least one uppercase letter (A to Z). * Require at least one lowercase letter (a to z). * Require at least one number (0 to 9). * Require at least one nonalphanumeric character (! @ # $ % ^ &amp; * ( ) _ + - = [ ] { } | ’).</p>
</section>
<section id="how-to-manage-aws-access-and-secret-keys" class="level2">
<h2 class="anchored" data-anchor-id="how-to-manage-aws-access-and-secret-keys">How to manage AWS access and secret keys?</h2>
<ul>
<li>Please store your access key ID (something like AKIAIOSFODNN7EXAMPLE) and a secret access key (something like wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY) in a very safe place.</li>
<li>Anyone who has your credentials has the same level of access to your AWS resources (e.g.&nbsp;EC2, S3, RDS etc) that you do. So they must be kept very secret. Please never share them with others or include them in your code.</li>
</ul>
</section>
<section id="how-to-install-and-upgrade-the-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-install-and-upgrade-the-aws-cli">How to install and upgrade the AWS CLI?</h2>
<pre><code>sudo easy_install pip
sudo pip install awscli --ignore-installed six
sudo pip install --upgrade awscli</code></pre>
</section>
<section id="how-to-configure-the-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-configure-the-aws-cli">How to configure the AWS CLI?</h2>
<pre><code>aws configure
AWS Access Key ID [None]: &lt;YOUR AWS ACCESS KEY&gt;
AWS Secret Access Key [None]: &lt;YOUR SECRET ACCESS KEY&gt;
Default region name [None]: us-east-1
Default output format [None]: json </code></pre>
</section>
<section id="how-to-launch-your-ec2-instances-through-aws-console" class="level2">
<h2 class="anchored" data-anchor-id="how-to-launch-your-ec2-instances-through-aws-console">How to launch your EC2 instances through AWS console?</h2>
<p>Amazon hosts its resources under different regions, after you login, make sure you are in ‘N. Virginia’ region, that’s where our virtual private clouds are setup.</p>
<ul>
<li>Create ssh key pair</li>
</ul>
<p>In order to access EC2 resources, you should first load your ssh public key onto amazon, so that VMs will be property configured when you try to launch them. - Click’Services’ on the top nav bar,selectEC2. - Select “NETWORK&amp;SECURITY” -&gt; Key Pairs on the left panel - Click”create key pair” if you want to create new key pair, or load your existing one. Please name your key pair under your username</p>
<ul>
<li><p>Launch a VM under public VPC</p></li>
<li><p>Select”Instances”-&gt;“LaunchInstance” in EC2 dashboard</p></li>
<li><p>Choose image you want to use</p></li>
<li><p>Chose an instance type based on your computing needs</p></li>
<li><p>Configure instance details with those choices, use the default ones if it’s not mentioned below:</p>
<ul>
<li>Network: public Subnet: public subnet</li>
<li>Auto-assign Public IP: enable</li>
</ul></li>
<li><p>Click “Review and Launch” ___ Security Groups -&gt; select an existing security group -&gt; select ‘default’ ___ Tags -&gt; create tag for your instance name: eg: Key: Name, Value: abc</p></li>
<li><p>Launch with your ssh keypair</p></li>
<li><p>Launch a VM under private VPC</p></li>
</ul>
<p>If you are going to use protected data, launch VMs under the private VPC. VMs launched under this VPC are under private network and do not have public access. This VPC has a public VM called “Login Node”. You should ssh onto that VM in order to reach VMs under the private network.</p>
<ul>
<li>Contact administrator to grant you access to login node</li>
<li>Launcha VM using the same instruction as for the public VPC, except for choosing those options when configuring instance details:
<ul>
<li>Network: main</li>
<li>Subnet: private</li>
<li>Auto-assign Public IP: Use subnet setting (Disable) security groups: select ‘local’</li>
</ul></li>
<li>After the VM is running, ssh onto login node,then ssh on to your VM to access it</li>
</ul>
</section>
<section id="how-to-launch-your-ec2-instance-using-cloudformation-through-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-launch-your-ec2-instance-using-cloudformation-through-cli">How to launch your EC2 instance using Cloudformation through CLI?</h2>
<p>-Download and modify the template here <span class="citation" data-cites="https://s3.amazonaws.com/imlab-jiamaoz/LaunchEC2InstanceUsingCloudformationTemplate.json">@https://s3.amazonaws.com/imlab-jiamaoz/LaunchEC2InstanceUsingCloudformationTemplate.json</span>.</p>
<ul>
<li>Upload your modified template to your bucket in s3</li>
<li>Run the following command in the terminal:</li>
</ul>
<pre><code>aws cloudformation update-stack --stack-name &lt;YOUR STACK NAME&gt; --template-url  https://s3.amazonaws.com/&lt;YOUR BUCKET NAME&gt;/LaunchEC2InstanceUsingCloudformationTemplate.json</code></pre>
</section>
<section id="how-to-associate-an-elastic-ip-address-to-your-ec2-instance" class="level2">
<h2 class="anchored" data-anchor-id="how-to-associate-an-elastic-ip-address-to-your-ec2-instance">How to associate an Elastic IP address to your EC2 instance</h2>
<pre><code>aws ec2 associate-address --instance-id &lt;YOUR INSTANCE ID&gt; --public-ip &lt;YOUR ELASTIC IP ADDRESS&gt;</code></pre>
</section>
<section id="how-to-peer-aws-vpc" class="level2">
<h2 class="anchored" data-anchor-id="how-to-peer-aws-vpc">How to peer AWS VPC?</h2>
<p>Please follow steps from <a title="AWS: Virtual Private Cloud" href="http://blog.celingest.com/en/2014/05/09/introduction-aws-vpc-peering/" target="_blank">An introduction to AWS VPC Peering</a></p>
</section>
<section id="how-to-get-your-amazon-ec2-instance-id-using-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-get-your-amazon-ec2-instance-id-using-aws-cli">How to get your Amazon EC2 instance id using AWS CLI?</h2>
<pre><code>aws ec2 describe-instances --filters "Name=tag:Name, Values=&lt;YOUR INSTANCE TAG NAME&gt;" --query 'Reservations[0].Instances[0].InstanceId'</code></pre>
</section>
<section id="how-to-stop-an-ec2-instance-using-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-stop-an-ec2-instance-using-aws-cli">How to stop an EC2 instance using AWS CLI?</h2>
<pre><code>aws ec2 stop-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'StoppingInstances[0].CurrentState.Name'</code></pre>
</section>
<section id="how-to-start-an-ec2-instance-using-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-start-an-ec2-instance-using-aws-cli">How to start an EC2 instance using AWS CLI?</h2>
<pre><code>aws ec2 start-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'StartingInstances[0].CurrentState.Name'</code></pre>
</section>
<section id="how-to-get-the-ip-address-of-the-running-instance-using-aws-cli" class="level2">
<h2 class="anchored" data-anchor-id="how-to-get-the-ip-address-of-the-running-instance-using-aws-cli">How to get the IP address of the running instance using AWS CLI?</h2>
<pre><code>aws ec2 describe-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'Reservations[0].Instances[0].PublicIpAddress'</code></pre>
</section>
<section id="how-to-automatically-stop-the-instance" class="level2">
<h2 class="anchored" data-anchor-id="how-to-automatically-stop-the-instance">How to automatically stop the instance?</h2>
<p>It’s highly recommended to create the CloudWatch alarm to stop your instance automatically by default.</p>
<pre><code>aws cloudwatch put-metric-alarm --alarm-name XXXXXX-stop-alarm --alarm-description "Stop the instance when it is idle for one hour" --namespace "AWS/EC2" --dimensions Name=InstanceId,Value="i-XXXXXX" --statistic Maximum --metric-name CPUUtilization --comparison-operator LessThanThreshold --threshold 5 --period 300 --evaluation-periods 12 --alarm-actions arn:aws:automate:us-east-1:ec2:stop --unit Percent</code></pre>
<p>Above <code>put-metric-alarm</code> command should generate a good CloudWatch alarm that will automatically stop the instance if the maxium CPU utilization of your instance is less than 5% over a hour period. Please replace the values for InstanceID and alarm name with your own values.</p>
<p>If you would like to receive email notification, please use the following <code>put-metric-alarm</code> command which includes your SNS topic <code>arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt;</code>. Please refer <code>How to set Up Amazon Simple Notification Service?</code> to set up your SNS topic.</p>
<pre><code>aws cloudwatch put-metric-alarm --alarm-name XXXXXX-stop-alarm --alarm-description "Stop the instance when it is idle for one hour" --namespace "AWS/EC2" --dimensions Name=InstanceId,Value="i-XXXXXX" --statistic Maximum --metric-name CPUUtilization --comparison-operator LessThanThreshold --threshold 5 --period 300 --evaluation-periods 12 --alarm-actions arn:aws:automate:us-east-1:ec2:stop arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt; --unit Percent</code></pre>
<p>There are three scenarios for stopped instance’s CloudWatch alarm .</p>
<ol type="1">
<li><p><code>No Data</code> alarm status. If you restart your instance, CloudWatch will work as expected.</p></li>
<li><p><code>ALARM</code> alarm status. If you restart your instance AND do some computational work, CloudWatch will work as expected. You will notice that <code>ALARM</code> alarm status will disappear and <code>OK</code> will appear in a few minutes.</p></li>
<li><p><code>ALARM</code> alarm status. If you restart your instance AND don’t do any computational work, CloudWatch will <code>NOT</code> work as expected. The instance will not automatically stop because the instance alarm status is still <code>ALARM</code>, and CloudWatch alarm won’t be triggered without any alarm status changes.</p></li>
</ol>
<p>Please avoid last scenario. To solve this, please either do some computational work (like scenario 2) or stop your instance and wait for at least 1 hour.</p>
</section>
<section id="how-to-set-up-amazon-simple-notification-service" class="level2">
<h2 class="anchored" data-anchor-id="how-to-set-up-amazon-simple-notification-service">How to set Up Amazon Simple Notification Service?</h2>
<p>1). Create the topic using the create-topic command. You receive a topic resource name as a return value:</p>
<pre><code>aws sns create-topic --name &lt;YOUR ALARM NAME&gt;</code></pre>
<p>2). Subscribe your email address to the topic using the subscribe command. You will receive a confirmation email message if the subscription request succeeds.</p>
<pre><code>aws sns subscribe --topic-arn arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt; --protocol email --notification-endpoint &lt;YOUR EMAIL ADDRESS&gt;</code></pre>
<p>3). Confirm that you intend to receive email from Amazon Simple Notification Service by clicking the confirmation link in the body of the message to complete the subscription process. <br><br> 4). Publish a message directly to the topic using the publish command to ensure that the topic is properly configured.</p>
<pre><code>aws sns publish --message "Verification" --topic arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt;</code></pre>
<p>5). Check your email to confirm that you received the message from the topic.</p>


<!-- -->

</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div>© HakyImLab and Listed Authors - CC BY 4.0 for Text and figures - MIT for code</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> How to Use AWS</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> ''</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> '2020-07-30'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="an">slug:</span><span class="co"> how-to-use-aws</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - how_to</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="an">tags:</span><span class="co"> []</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Im lab's AWS Best Practices</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stop/start your EC2 instances programatically through AWS Command Line Interface (CLI).</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Stop your EC2 instances to avoid incurring charges when not in use.</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Your secret key must be kept very secret. Please store it in a very safe place and don't include it in your code.</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to login to your AWS account?</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>you should have gotten the credentials from the lab's cloud administrator https://hakyimlab.signin.aws.amazon.com/console</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>Once you login to your account using temporary password, you can reset your password by the following policy: <span class="sc">\*</span> Minimum password length (6 to 128). <span class="sc">\*</span> Require at least one uppercase letter (A to Z). <span class="sc">\*</span> Require at least one lowercase letter (a to z). <span class="sc">\*</span> Require at least one number (0 to 9). <span class="sc">\*</span> Require at least one nonalphanumeric character (! \@ <span class="sc">\#</span> \$ % \^ &amp; <span class="sc">\*</span> ( ) <span class="sc">\_</span> + - = <span class="sc">\[</span> <span class="sc">\]</span> { } \| ').</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to manage AWS access and secret keys?</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Please store your access key ID (something like AKIAIOSFODNN7EXAMPLE) and a secret access key (something like wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY) in a very safe place.</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Anyone who has your credentials has the same level of access to your AWS resources (e.g. EC2, S3, RDS etc) that you do. So they must be kept very secret. Please never share them with others or include them in your code.</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to install and upgrade the AWS CLI?</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="in">sudo easy_install pip</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="in">sudo pip install awscli --ignore-installed six</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="in">sudo pip install --upgrade awscli</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to configure the AWS CLI?</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="in">aws configure</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="in">AWS Access Key ID [None]: &lt;YOUR AWS ACCESS KEY&gt;</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="in">AWS Secret Access Key [None]: &lt;YOUR SECRET ACCESS KEY&gt;</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="in">Default region name [None]: us-east-1</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="in">Default output format [None]: json </span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to launch your EC2 instances through AWS console?</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>Amazon hosts its resources under different regions, after you login, make sure you are in 'N. Virginia' region, that's where our virtual private clouds are setup.</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Create ssh key pair</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>In order to access EC2 resources, you should first load your ssh public key onto amazon, so that VMs will be property configured when you try to launch them. - Click'Services' on the top nav bar,selectEC2. - Select "NETWORK&amp;SECURITY" -<span class="sc">\&gt;</span> Key Pairs on the left panel - Click"create key pair" if you want to create new key pair, or load your existing one. Please name your key pair under your username</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Launch a VM under public VPC</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Select"Instances"-<span class="sc">\&gt;</span>"LaunchInstance" in EC2 dashboard</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Choose image you want to use</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Chose an instance type based on your computing needs</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Configure instance details with those choices, use the default ones if it's not mentioned below:</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Network: public Subnet: public subnet</span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Auto-assign Public IP: enable</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Click "Review and Launch" ___ Security Groups -<span class="sc">\&gt;</span> select an existing security group -<span class="sc">\&gt;</span> select 'default' ___ Tags -<span class="sc">\&gt;</span> create tag for your instance name: eg: Key: Name, Value: abc</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Launch with your ssh keypair</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Launch a VM under private VPC</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>If you are going to use protected data, launch VMs under the private VPC. VMs launched under this VPC are under private network and do not have public access. This VPC has a public VM called "Login Node". You should ssh onto that VM in order to reach VMs under the private network.</span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Contact administrator to grant you access to login node</span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Launcha VM using the same instruction as for the public VPC, except for choosing those options when configuring instance details:</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Network: main</span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Subnet: private</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Auto-assign Public IP: Use subnet setting (Disable) security groups: select 'local'</span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>After the VM is running, ssh onto login node,then ssh on to your VM to access it</span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to launch your EC2 instance using Cloudformation through CLI?</span></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a>-Download and modify the template here @https://s3.amazonaws.com/imlab-jiamaoz/LaunchEC2InstanceUsingCloudformationTemplate.json.</span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Upload your modified template to your bucket in s3</span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Run the following command in the terminal:</span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="in">aws cloudformation update-stack --stack-name &lt;YOUR STACK NAME&gt; --template-url  https://s3.amazonaws.com/&lt;YOUR BUCKET NAME&gt;/LaunchEC2InstanceUsingCloudformationTemplate.json</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to associate an Elastic IP address to your EC2 instance</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="in">aws ec2 associate-address --instance-id &lt;YOUR INSTANCE ID&gt; --public-ip &lt;YOUR ELASTIC IP ADDRESS&gt;</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to peer AWS VPC?</span></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a>Please follow steps from <span class="kw">&lt;a</span> <span class="er">title</span><span class="ot">=</span><span class="st">"AWS: Virtual Private Cloud"</span> <span class="er">href</span><span class="ot">=</span><span class="st">"http://blog.celingest.com/en/2014/05/09/introduction-aws-vpc-peering/"</span> <span class="er">target</span><span class="ot">=</span><span class="st">"_blank"</span><span class="kw">&gt;</span>An introduction to AWS VPC Peering<span class="kw">&lt;/a&gt;</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to get your Amazon EC2 instance id using AWS CLI?</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="in">aws ec2 describe-instances --filters "Name=tag:Name, Values=&lt;YOUR INSTANCE TAG NAME&gt;" --query 'Reservations[0].Instances[0].InstanceId'</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to stop an EC2 instance using AWS CLI?</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="in">aws ec2 stop-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'StoppingInstances[0].CurrentState.Name'</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to start an EC2 instance using AWS CLI?</span></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="in">aws ec2 start-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'StartingInstances[0].CurrentState.Name'</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to get the IP address of the running instance using AWS CLI?</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="in">aws ec2 describe-instances --instance-ids &lt;YOUR INSTANCE ID&gt; --query 'Reservations[0].Instances[0].PublicIpAddress'</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to automatically stop the instance?</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a>It's highly recommended to create the CloudWatch alarm to stop your instance automatically by default.</span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a><span class="in">aws cloudwatch put-metric-alarm --alarm-name XXXXXX-stop-alarm --alarm-description "Stop the instance when it is idle for one hour" --namespace "AWS/EC2" --dimensions Name=InstanceId,Value="i-XXXXXX" --statistic Maximum --metric-name CPUUtilization --comparison-operator LessThanThreshold --threshold 5 --period 300 --evaluation-periods 12 --alarm-actions arn:aws:automate:us-east-1:ec2:stop --unit Percent</span></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a>Above <span class="in">`put-metric-alarm`</span> command should generate a good CloudWatch alarm that will automatically stop the instance if the maxium CPU utilization of your instance is less than 5% over a hour period. Please replace the values for InstanceID and alarm name with your own values.</span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>If you would like to receive email notification, please use the following <span class="in">`put-metric-alarm`</span> command which includes your SNS topic <span class="in">`arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt;`</span>. Please refer <span class="in">`How to set Up Amazon Simple Notification Service?`</span> to set up your SNS topic.</span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="in">aws cloudwatch put-metric-alarm --alarm-name XXXXXX-stop-alarm --alarm-description "Stop the instance when it is idle for one hour" --namespace "AWS/EC2" --dimensions Name=InstanceId,Value="i-XXXXXX" --statistic Maximum --metric-name CPUUtilization --comparison-operator LessThanThreshold --threshold 5 --period 300 --evaluation-periods 12 --alarm-actions arn:aws:automate:us-east-1:ec2:stop arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt; --unit Percent</span></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a>There are three scenarios for stopped instance's CloudWatch alarm .</span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a>1)  <span class="in">`No Data`</span> alarm status. If you restart your instance, CloudWatch will work as expected.</span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a>2)  <span class="in">`ALARM`</span> alarm status. If you restart your instance AND do some computational work, CloudWatch will work as expected. You will notice that <span class="in">`ALARM`</span> alarm status will disappear and <span class="in">`OK`</span> will appear in a few minutes.</span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a>3)  <span class="in">`ALARM`</span> alarm status. If you restart your instance AND don't do any computational work, CloudWatch will <span class="in">`NOT`</span> work as expected. The instance will not automatically stop because the instance alarm status is still <span class="in">`ALARM`</span>, and CloudWatch alarm won't be triggered without any alarm status changes.</span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>Please avoid last scenario. To solve this, please either do some computational work (like scenario 2) or stop your instance and wait for at least 1 hour.</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## How to set Up Amazon Simple Notification Service?</span></span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a>1). Create the topic using the create-topic command. You receive a topic resource name as a return value:</span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a><span class="in">aws sns create-topic --name &lt;YOUR ALARM NAME&gt;</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a>2). Subscribe your email address to the topic using the subscribe command. You will receive a confirmation email message if the subscription request succeeds.</span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="in">aws sns subscribe --topic-arn arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt; --protocol email --notification-endpoint &lt;YOUR EMAIL ADDRESS&gt;</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a>3). Confirm that you intend to receive email from Amazon Simple Notification Service by clicking the confirmation link in the body of the message to complete the subscription process. <span class="kw">&lt;br&gt;&lt;br&gt;</span> 4). Publish a message directly to the topic using the publish command to ensure that the topic is properly configured.</span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a><span class="in">aws sns publish --message "Verification" --topic arn:aws:sns:us-east-1:215500445195:&lt;YOUR ALARM NAME&gt;</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a>5). Check your email to confirm that you received the message from the topic.</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>