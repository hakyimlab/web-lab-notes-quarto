{
  "hash": "f76fb9cf4f4b2fbd35a7e0cdb3867403",
  "result": {
    "markdown": "---\ntitle: How to calculate Z-score, P-value, Chi2 stat from GWAS\nauthor: Haky Im\ndate: '2022-04-13'\n---\n\n\n\n::: {.callout-tip}\n## Summary\nGiven one of the statistics in a GWAS (Z-score, P-value, or chi2), calculate the others.\n:::\n\n\n## Calculate Zscore, p-value, Chi2 statistics using GWAS summary statistics\n\n$$Y = \\beta \\cdot X + \\epsilon$$\nGWAS summary statistics will contain an estimate of the regression coefficient $\\hat\\beta$ and its standard error $\\text{se}(\\hat\\beta)$ for each SNP in the GWAS.\n\nWe distinguish the true $\\beta$ from the estimated value $\\hat\\beta$ using a hat.\n\n## Z-score\n\n$$ Z = \\frac{\\hat\\beta}{\\text{se}(\\hat\\beta)}$$\n$$Z \\approx N(0,1) ~~~~~~ \\text{as } n \\rightarrow \\infty$$\n\n\n## Z to Chi2 statistic\n\n$$Z^2 \\sim \\chi^2_\\text{df=1}$$\n\nUnder the null, the squared of the Z-score follows a $\\chi^2$ distribution with 1 degree of freedom.\n\n## Z to P-value\n\n$$P = \\text{pnorm}(-|Z|) * 2$$\n\n## P to Z\n\nFrom the p-value, we can calculate the magnitude of the Z-score but the sign is lost. So the Z-score has more information than the p-value.\n\n$$|Z| = |\\text{qnorm}(P/2)|$$\n\n## P to Chi2\n\n$$ \\chi^2 =  \\text{qnorm}(P/2)^2 $$\n\n-------\n\n## Simulations \n\nLet's simulate zscore vector under the null hypothesis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnsim = 5000\nset.seed(2021021001)\nzvec = rnorm(5000, mean=0, sd=1)\n```\n:::\n\n\nCalculate the p-value (probability that a normal r.v. will be as large or larger in magnitude than the |zscore| \n\n::: {.cell}\n\n```{.r .cell-code}\npvec = pnorm(-abs(zvec)) * 2 ## two-tailed\n## check pvec is uniformly distributed\nhist(pvec,main=\"is this uniformly distributed?\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\n## remember that if square the a normal r.v. you get chi2 r.v. with one degree of freedom\nz2vec = zvec^2\n## compare with chi2 rv. with 1 degree of freedom by simulating chi2,1 and qqplot\nchi2vec = rchisq(nsim,df=1)\nqqplot(chi2vec,z2vec,main=\"compare of zscore^2 and a chi2 r.v.\"); abline(0,1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## test whether the distributions of z2vec and chi2vec are different using the Kologorov Smirnov test\nks.test(z2vec,chi2vec)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tAsymptotic two-sample Kolmogorov-Smirnov test\n\ndata:  z2vec and chi2vec\nD = 0.019, p-value = 0.3275\nalternative hypothesis: two-sided\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## for reference, let's compare two chi2,1 r.v.'s qqplot\nchi2vec_2 = rchisq(nsim,df=1)\nqqplot(chi2vec,chi2vec_2,main=\"qqplot of two chi2,1 r.v.\"); abline(0,1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nks.test(chi2vec,chi2vec_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tAsymptotic two-sample Kolmogorov-Smirnov test\n\ndata:  chi2vec and chi2vec_2\nD = 0.0158, p-value = 0.5605\nalternative hypothesis: two-sided\n```\n:::\n:::\n\n\n> Sometimes you get the p-value instead of the zscore, you can generate chi2 by inverting the relationship.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchi2vec_from_p = qnorm(pvec / 2)^2\nqqplot(chi2vec,chi2vec_from_p,main=\"chi2 from pvalue vs chi2 r.v.\"); abline(0,1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}